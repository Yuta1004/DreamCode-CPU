IMAGE := riscv/devenv

GCC_OPTS := \
    -O2 \
    -T link.ld \
    -march=rv32i_zicsr \
    -mabi=ilp32 \
    -no-pie \
    -nostdlib \
    -static
OD_OPTS := \
    -An \
    -tx4 \
    -w4 \
    -v

bootrom.mem: $(shell find src -name "*.c")
	riscv64-unknown-elf-gcc $(GCC_OPTS) src/start.S $^ -o out/bootrom
	riscv64-unknown-elf-objdump -D out/bootrom > out/bootrom.dump
	riscv64-unknown-elf-objcopy -O binary out/bootrom out/bootrom.bin
	od $(OD_OPTS) out/bootrom.bin > out/bootrom.mem
	xxd -i out/bootrom.bin > out/bootrom.h
