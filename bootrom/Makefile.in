IMAGE := riscv/devenv

SRCS := $(shell find src/*.c)
OBJS := $(SRCS:.c=.o)

hex: main
	mkdir -p out
	riscv64-unknown-elf-objcopy -O binary out/main out/bootrom.bin
	riscv64-unknown-elf-objdump -d out/main > out/bootrom.dump
	od -An -tx1 -w1 -v out/bootrom.bin > out/bootrom.mem

main: $(OBJS)
	mkdir -p out
	riscv64-unknown-elf-ld -b elf32-littleriscv $(OBJS) -T link.ld -o out/main

.c.o:
	riscv64-unknown-elf-gcc -march=rv32i -mabi=ilp32 -c $< -o $@
